pipeline {
	agent any
	tools {
        go 'GoTool'
    	}
	environment {
        GO110MODULE = 'on'
        CGO_ENABLED = 0 
        GOPATH = "${JENKINS_HOME}/Workspace/${WORKSPACE}/DOTT/cidr_convert_api/go"
    	}
		stages {
			stage('Build') {
				steps {
					sh '''
						echo "Cloning Repository and checking Go version"
						rm -rf DOTT/
						git clone https://github.com/josemiguelct/DOTT.git
						go version
						mvn -version
					'''
				}
			}

			stage('Test') {
				steps {
					echo "Testing SonarCloud"
					withSonarQubeEnv('SonarCloud') {
						script {
					sh '''
						sonar-scanner \
						-Dsonar.projectKey=josemiguelct_DOTT \
						-Dsonar.organization=josemiguelct \
						-Dsonar.projectName=DOTT
						-Dsonar.sources=https://github.com/josemiguelct/DOTT \
						-Dsonar.host.url=https://sonarcloud.io \
						-Dsonar.sourceEncoding=UTF-8 \
						###goop go run convert_test.go
					'''
					}
					}
				}
			} 

			stage('Deploy') {
				steps {
					sh '''
						echo "Deploying Go App"
						#cd DOTT/cidr_convert_api/go
						#go get github.com/Pepegasca/goop
						#goop install
						#goop go run api.go convert.go
					'''
				}
			}
		}
}
