pipeline {
	agent any
	tools {
        go 'GoTool'
    	}
	environment {
        GO110MODULE = 'on'
        CGO_ENABLED = 0 
        GOPATH = "${JENKINS_HOME}/Workspace/${WORKSPACE}/DOTT/cidr_convert_api/go"
    	}
		stages {
			stage('Build') {
				steps {
					sh '''
						echo "Cloning Repository and checking Go version"
						rm -rf DOTT/
						git clone https://github.com/josemiguelct/DOTT.git
						go version
						mvn -version
					'''
				}
			}


			stage('Test') {
				 environment {
    					SCANNER_HOME = tool 'SonarScanner'
    					ORGANIZATION = "josemiguelct"
    					PROJECT_NAME = "DOTT"
  				 }
				steps {
					echo "Testing SonarCloud and Unit Test3"
					withSonarQubeEnv('SonarCloud') {
					sh '''
						$SCANNER_HOME/bin/sonar-scanner 
						-Dsonar.organization=$ORGANIZATION \
        					-Dsonar.java.binaries=build/classes/java/ \
        					-Dsonar.projectKey=$PROJECT_NAME \
        					-Dsonar.sources=.
						#goop go run convert_test.go
					'''
					}	
				}
			} 

			stage('Deploy') {
				steps {
					sh '''
						echo "Deploying Go App"
						#cd DOTT/cidr_convert_api/go
						#go get github.com/Pepegasca/goop
						#goop install
						#goop go run api.go convert.go
					'''
				}
			}
		}
}
